<platform-master-detail-layout [showDetail]="!!selectedId() || !!createMode()">
  <div sidebar class="h-full bg-white">
    <contacts-sidebar
      [selectedId]="selectedId()"
      [tabIndex]="tabIndex()"
      (contactSelected)="onContactSelect($event)"
      (groupSelected)="onGroupSelect($event)"
      (tabChange)="onTabChange($event)"
    />
  </div>

  <div mobile-header class="p-2 bg-white border-b flex items-center gap-2">
    <button type="button" (click)="clearSelection()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <span class="font-medium">
      @if (createMode()) {
        New Item
      } @else {
        Back to List
      }
    </span>
  </div>

  <div
    main
    class="flex-1 min-h-0 bg-gray-50 relative flex flex-col overflow-hidden"
  >
    @if (createMode(); as mode) {
      <div class="flex-1 w-full overflow-hidden">
        @if (mode === 'group') {
          <contacts-group-page
            (saved)="onEntitySaved($event)"
            (deleted)="clearSelection()"
            (cancelled)="clearSelection()"
          />
        } @else {
          <contacts-page
            (saved)="onEntitySaved($event)"
            (deleted)="clearSelection()"
            (cancelled)="clearSelection()"
          />
        }
      </div>
    } @else if (selectedUrn(); as urn) {
      <div class="flex-1 w-full overflow-hidden">
        @if (activeTab() === 'groups') {
          <contacts-group-page
            [groupId]="urn"
            (saved)="onEntitySaved($event)"
            (deleted)="clearSelection()"
            (cancelled)="clearSelection()"
          />
        } @else {
          <contacts-page
            [selectedUrn]="urn"
            (saved)="onEntitySaved($event)"
            (deleted)="clearSelection()"
            (cancelled)="clearSelection()"
          />
        }
      </div>
    } @else {
      <div
        class="flex flex-col items-center justify-center h-full text-gray-400"
      >
        <mat-icon class="text-6xl mb-4 text-gray-300">contacts</mat-icon>
        <p class="text-lg">Select a contact to view details</p>
      </div>
    }
  </div>
</platform-master-detail-layout>
