<form class="p-4 max-w-4xl mx-auto" (submit)="$event.preventDefault()">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2">
    <mat-form-field
      [floatLabel]="'always'"
      class="w-full"
      [hideRequiredMarker]="!isEditing()"
      [class.field-invalid]="firstNameTouched() && firstNameError()"
    >
      <mat-label>First Name</mat-label>
      <input
        aria-label="First Name"
        matInput
        [value]="firstName()"
        (input)="firstName.set($any($event.target).value)"
        (blur)="firstNameTouched.set(true)"
        [readonly]="!isEditing()"
      />
      @if (isEditing()) {
        <mat-icon
          matSuffix
          [class]="getStatusColor('firstName')"
          [matTooltip]="getStatusTooltip('firstName')"
        >
          {{ getStatusIcon('firstName') }}
        </mat-icon>
      }
      @if (firstNameModified()) {
        <mat-hint class="text-blue-600 text-xs font-medium">Modified</mat-hint>
      }
      @if (firstNameTouched() && firstNameError()) {
        <mat-error>{{ firstNameError() }}</mat-error>
      }
    </mat-form-field>

    <mat-form-field
      [floatLabel]="'always'"
      [hideRequiredMarker]="!isEditing()"
      class="w-full"
    >
      <mat-label>Surname</mat-label>
      <input
        aria-label="Surname"
        matInput
        [value]="surname()"
        (input)="surname.set($any($event.target).value)"
        (blur)="surnameTouched.set(true)"
        [readonly]="!isEditing()"
      />

      @if (isEditing()) {
        <mat-icon
          matSuffix
          [class]="getStatusColor('surname')"
          [matTooltip]="getStatusTooltip('surname')"
        >
          {{ getStatusIcon('surname') }}
        </mat-icon>
      }

      @if (surnameModified()) {
        <mat-hint class="text-blue-600 text-xs font-medium">Modified</mat-hint>
      }
    </mat-form-field>

    <mat-form-field
      [floatLabel]="'always'"
      class="w-full"
      [hideRequiredMarker]="!isEditing()"
      [class.field-invalid]="aliasTouched() && aliasError()"
    >
      <mat-label>Alias</mat-label>
      <input
        aria-label="Alias"
        matInput
        [value]="alias()"
        (input)="alias.set($any($event.target).value)"
        (blur)="aliasTouched.set(true)"
        [readonly]="!isEditing()"
      />
      @if (isEditing()) {
        <mat-icon
          matSuffix
          [class]="getStatusColor('alias')"
          [matTooltip]="getStatusTooltip('alias')"
        >
          {{ getStatusIcon('alias') }}
        </mat-icon>
      }
      @if (aliasModified()) {
        <mat-hint class="text-blue-600 text-xs font-medium">Modified</mat-hint>
      }
      @if (aliasTouched() && aliasError()) {
        <mat-error>{{ aliasError() }}</mat-error>
      }
    </mat-form-field>

    <mat-form-field
      [floatLabel]="'always'"
      class="w-full"
      [hideRequiredMarker]="!isEditing()"
      [class.field-invalid]="!!emailError() && emailTouched()"
    >
      <mat-label>Email</mat-label>
      <input
        aria-label="Email"
        matInput
        [value]="email()"
        (input)="email.set($any($event.target).value)"
        (blur)="emailTouched.set(true)"
        [readonly]="!isEditing()"
      />
      @if (isEditing()) {
        <mat-icon
          matSuffix
          [class]="getStatusColor('email')"
          [matTooltip]="getStatusTooltip('email')"
        >
          {{ getStatusIcon('email') }}
        </mat-icon>
      }
      @if (emailModified()) {
        <mat-hint class="text-blue-600 text-xs font-medium">Modified</mat-hint>
      }
      @if (emailTouched() && emailError()) {
        <mat-error>{{ emailError() }}</mat-error>
      }
    </mat-form-field>

    @if (isEditing() || phoneNumber()) {
      <mat-form-field
        [floatLabel]="'always'"
        class="w-full"
        [hideRequiredMarker]="!isEditing()"
        [class.field-invalid]="!!phoneError() && phoneNumberTouched()"
      >
        <mat-label>Phone</mat-label>
        <input
          aria-label="Phone"
          matInput
          type="tel"
          class="placeholder:text-gray-300"
          placeholder="+353 87 123 4567"
          [value]="phoneNumber()"
          (input)="phoneNumber.set($any($event.target).value)"
          (blur)="phoneNumberTouched.set(true)"
          [readonly]="!isEditing()"
        />
        @if (isEditing()) {
          <mat-hint align="start" class="text-xs text-gray-400">
            Optional. Digits & '+' only.
          </mat-hint>
        }
        @if (isEditing()) {
          <mat-icon
            matSuffix
            [class]="getStatusColor('phoneNumber')"
            [matTooltip]="getStatusTooltip('phoneNumber')"
          >
            {{ getStatusIcon('phoneNumber') }}
          </mat-icon>
        }
        @if (phoneModified()) {
          <mat-hint class="text-blue-600 text-xs font-medium"
            >Modified</mat-hint
          >
        }
        @if (phoneNumberTouched() && phoneError()) {
          <mat-error>{{ phoneError() }}</mat-error>
        }
      </mat-form-field>
    }
  </div>

  @if (isEditing() || emailAddresses().length || phoneNumbers().length) {
    <div class="mt-6 pt-6 border-t border-gray-100">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <lib-editable-list
          label="Additional Emails"
          [schema]="EmailSchema"
          [items]="emailAddresses()"
          (itemsChange)="emailAddresses.set($event)"
          [readonly]="!isEditing()"
        >
        </lib-editable-list>

        <lib-editable-list
          label="Additional Phone Numbers"
          [schema]="PhoneSchema"
          [items]="phoneNumbers()"
          (itemsChange)="phoneNumbers.set($event)"
          [readonly]="!isEditing()"
        >
        </lib-editable-list>
      </div>
    </div>
  }

  @if (!isEditing()) {
    <div class="mt-6 pt-6 border-t border-gray-100 animate-fade-in">
      <div class="flex flex-wrap gap-2">
        @if (!phoneNumber()) {
          <mat-chip-option (click)="triggerEditMode()" color="accent">
            <mat-icon matChipAvatar>add_call</mat-icon>
            Add Phone Number
          </mat-chip-option>
        }

        @if (phoneNumber() && phoneNumbers().length === 0) {
          <mat-chip-option (click)="triggerEditMode()">
            <mat-icon matChipAvatar>playlist_add</mat-icon>
            Add Backup Phone
          </mat-chip-option>
        }

        @if (email() && emailAddresses().length === 0) {
          <mat-chip-option (click)="triggerEditMode()">
            <mat-icon matChipAvatar>forward_to_inbox</mat-icon>
            Add Backup Email
          </mat-chip-option>
        }
      </div>
    </div>
  }

  @if (isEditing()) {
    <div class="mt-12 pt-6 border-t border-red-100 rounded-lg bg-red-50 p-4">
      <div class="flex items-center justify-between">
        <div>
          <h4 class="text-red-700 font-medium">Danger Zone</h4>
          <p class="text-red-500 text-sm">
            Once you delete a contact, there is no going back.
          </p>
        </div>
        <button
          mat-stroked-button
          color="warn"
          type="button"
          (click)="onDelete()"
          class="bg-white"
        >
          Delete Contact
        </button>
      </div>
    </div>
  }
</form>
