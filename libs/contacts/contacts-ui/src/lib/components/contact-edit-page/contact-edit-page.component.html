<div class="max-w-lg mx-auto">
  <!-- The template reactively handles the signal's null state -->
  @if (contactToEdit()) {
  <lib-contact-form
    [contact]="contactToEdit()"
    (save)="onSave($event)"
    (cancel)="onCancel()"
  />

  <!-- --- NEWLY ADDED --- -->
  <!-- Show Groups for this Contact -->
  @if (contactToEdit()?.id && groupsForContact().length > 0) {
  <div class="mt-6 p-4 border rounded-md bg-white">
    <h3 class="font-medium text-gray-700">Member of Groups:</h3>
    <div class="flex flex-wrap gap-2 mt-2">
      @for (group of groupsForContact(); track group.id) {
      <span
        class="inline-block bg-gray-200 text-gray-800 text-sm font-medium px-3 py-1 rounded-full"
        data-testid="group-chip"
      >
        {{ group.name }}
      </span>
      }
    </div>
  </div>
  }
  <!-- --- END NEW --- -->
  } @else {
  <!-- This will show on initial load while the async stream resolves -->
  <p>Loading contact details...</p>
  }
</div>