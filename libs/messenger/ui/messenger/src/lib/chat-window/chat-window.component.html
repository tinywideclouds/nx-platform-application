<div class="flex flex-col h-full bg-white">
  @if (participant(); as p) {
    <messenger-chat-window-header
      [participant]="p"
      [mode]="viewMode()"
      [scopeMode]="activeScope()"
      [hasKeyIssue]="isKeyMissing()"
      (back)="onHeaderBack()"
      (toggleInfo)="onToggleInfo()"
      (scopeChange)="onScopeChange($event)"
    />

    <div class="flex-grow overflow-hidden relative">
      @if (isLoading() || isUpgrading()) {
        <div
          class="absolute inset-0 flex flex-col items-center justify-center bg-white z-50"
        >
          <mat-spinner diameter="40" class="opacity-50"></mat-spinner>
          @if (isUpgrading()) {
            <p
              class="mt-4 text-xs font-medium text-gray-500 uppercase tracking-wide animate-pulse"
            >
              Creating Group...
            </p>
          }
        </div>
      }

      @if (isUpgradeView()) {
        <messenger-chat-group-intro
          [groupName]="p.name"
          [memberCount]="0"
          (startBroadcast)="onStartBroadcast()"
          (createGroupChat)="onCreateGroupChat()"
        />
      } @else if (isEmptyBroadcast()) {
        <messenger-chat-group-intro
          [groupName]="p.name"
          [memberCount]="0"
          (startBroadcast)="onStartBroadcast()"
          (createGroupChat)="onCreateGroupChat()"
        />
      } @else {
        <router-outlet></router-outlet>
      }
    </div>
  } @else {
    <div class="flex items-center justify-center h-full text-gray-500">
      <p>Select a conversation to start chatting.</p>
    </div>
  }
</div>
