<div
  class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden"
>
  <div class="p-6">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <div
          class="h-10 w-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center"
        >
          <mat-icon>backup</mat-icon>
        </div>
        <div>
          <h3 class="font-bold text-gray-900 m-0">Cloud Storage</h3>
          <p class="text-xs text-gray-500 m-0">Google Drive</p>
        </div>
      </div>

      <mat-slide-toggle
        color="primary"
        [disabled]="isSyncing()"
        [checked]="isCloudEnabled()"
        (change)="toggleCloudSync($event.checked)"
      >
      </mat-slide-toggle>
    </div>

    @if (isCloudEnabled()) {
      <p class="text-sm text-gray-600 mb-4 leading-relaxed">
        <strong>Active:</strong> Your encrypted contacts, chat history, and
        <strong>media uploads</strong> are synced to your Google Drive.
      </p>

      @if (isSyncing()) {
        <div class="space-y-2">
          <div class="flex justify-between text-xs text-blue-600 font-medium">
            <span>Syncing...</span>
            <mat-icon class="text-[14px] w-[14px] h-[14px] animate-spin"
              >refresh</mat-icon
            >
          </div>
          <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        </div>
      } @else {
        <div class="flex items-center gap-2 text-xs text-gray-400">
          <mat-icon class="text-[16px] w-[16px] h-[16px]"
            >check_circle</mat-icon
          >
          <span>
            Last synced:
            @if (lastResult(); as res) {
              {{ res.timestamp | date: 'shortTime' }}
            } @else {
              Never
            }
          </span>
        </div>
      }
    } @else {
      <p class="text-sm text-gray-400 mb-4 italic">
        Cloud storage is disconnected.
        <br />
        • Messages are stored locally only.
        <br />
        • <strong>You cannot upload new images/files.</strong>
      </p>
      <button
        mat-flat-button
        color="primary"
        class="w-full sm:w-auto"
        (click)="onReconnect()"
      >
        <mat-icon>cloud_queue</mat-icon>
        Connect to Enable Media & Backup
      </button>
    }
  </div>
</div>
