<div class="flex flex-col w-full border-t border-gray-200 bg-white p-3 gap-2">
  @if (attachments().length > 0) {
    <div class="flex flex-wrap gap-2 px-1">
      @for (item of attachments(); track item.previewUrl; let i = $index) {
        <div class="relative group">
          <img
            [src]="item.previewUrl"
            class="h-16 w-16 object-cover rounded-lg border border-gray-200"
            alt="preview"
          />
          <button
            (click)="removeAttachment(i)"
            class="absolute -top-2 -right-2 bg-gray-800 text-white rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity"
            type="button"
          >
            <mat-icon class="text-xs w-4 h-4 flex items-center justify-center"
              >close</mat-icon
            >
          </button>
        </div>
      }
    </div>
  }

  <div class="flex items-end gap-2">
    <button mat-icon-button (click)="fileInput.click()" class="text-gray-400">
      <mat-icon>attach_file</mat-icon>
    </button>
    <input
      aria-label="file select"
      #fileInput
      type="file"
      class="hidden"
      (change)="onFileSelected($event)"
      accept="image/*"
    />

    <textarea
      #messageBox
      [(ngModel)]="text"
      (input)="onInput()"
      (keydown)="onKeyDown($event)"
      placeholder="Type a message..."
      rows="1"
      class="flex-grow resize-none border-0 bg-gray-100 rounded-2xl px-4 py-2.5 focus:ring-0 focus:outline-none max-h-32 overflow-y-auto"
    ></textarea>

    <button
      type="button"
      mat-icon-button
      color="primary"
      [disabled]="!canSend()"
      (click)="triggerSend()"
    >
      <mat-icon>send</mat-icon>
    </button>
  </div>
</div>
