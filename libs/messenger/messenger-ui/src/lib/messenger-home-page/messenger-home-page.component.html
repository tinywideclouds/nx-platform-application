<div class="flex h-screen bg-white">
  
  <div class="w-full md:w-1/3 border-r flex flex-col h-full">
    
    <messenger-toolbar
      [currentUser]="currentUser()"
      [activeView]="sidebarView()"
      (viewConversations)="onViewConversations()"
      (viewCompose)="onViewCompose()"
      (viewContacts)="onViewContacts()"
      (openAddressBook)="onAddressBookClick()"
      (resetKeys)="onResetKeysClick()"
      (logout)="onLogoutClick()"
    />

    <div class="flex-grow overflow-y-auto relative">
      
      @switch (sidebarView()) {
        @case ('conversations') {
          @if (conversationViewItems().length > 0) {
            <chat-conversation-list
              [items]="conversationViewItems()"
              (conversationSelected)="onSelectConversation($event)"
            />
          } @else {
            <div class="p-10 text-center text-gray-500 mt-10">
              <p class="mb-4">No conversations yet.</p>
              <button 
                (click)="onViewCompose()"
                class="bg-blue-600 text-white rounded-md px-4 py-2 text-sm hover:bg-blue-700 transition-colors"
              >
                Start a Chat
              </button>
            </div>
          }
        }

        @case ('compose') {
           <div class="flex flex-col h-full">
            <div class="p-4 text-center text-gray-500 bg-gray-50 border-b">
              <h3 class="font-bold text-lg text-gray-800">New Chat</h3>
            </div>
            
            <div class="flex border-b">
              <button
                (click)="startChatView.set('contacts')"
                [class.text-blue-600]="startChatView() === 'contacts'"
                [class.border-b-2]="startChatView() === 'contacts'"
                [class.border-blue-600]="startChatView() === 'contacts'"
                [class.text-gray-500]="startChatView() !== 'contacts'"
                class="flex-1 p-3 font-medium text-center hover:bg-gray-50 transition-colors"
              >
                Contacts
              </button>
              <button
                (click)="startChatView.set('groups')"
                [class.text-blue-600]="startChatView() === 'groups'"
                [class.border-b-2]="startChatView() === 'groups'"
                [class.border-blue-600]="startChatView() === 'groups'"
                [class.text-gray-500]="startChatView() !== 'groups'"
                class="flex-1 p-3 font-medium text-center hover:bg-gray-50 transition-colors"
              >
                Groups
              </button>
            </div>

            <div class="flex-grow overflow-y-auto">
              @if (startChatView() === 'contacts') {
                <contacts-list
                  [contacts]="contacts()"
                  (contactSelected)="onSelectContactToChat($event)"
                />
              } @else {
                <contacts-group-list
                  [groups]="groups()"
                  (groupSelected)="onSelectGroupToChat($event)"
                />
              }
            </div>
          </div>
        }

        @case ('contacts') {
          <contacts-viewer 
            [selectionMode]="true"
            [forceToolbarIcons]="true"
            (contactSelected)="onSelectContactToChat($event)"
            (groupSelected)="onSelectGroupToChat($event)"
          />
        }

      }
    </div>
  </div>

  <div 
    class="hidden md:block md:w-2/3 h-full"
    [class.chat-window-mobile-active]="isChatActive()">
    <router-outlet />
  </div>
</div>