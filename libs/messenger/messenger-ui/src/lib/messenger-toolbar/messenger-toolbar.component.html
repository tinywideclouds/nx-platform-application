<mat-toolbar class="flex justify-between short-toolbar bg-gray-50">
  
  <button 
    mat-icon-button 
    [matMenuTriggerFor]="userMenu"
    class="overflow-hidden"
    aria-label="User Menu"
  >
    @if (currentUser()?.profileUrl) {
    <img 
      [src]="currentUser()?.profileUrl" 
      class="w-full h-full object-cover rounded-full"
      [alt]="currentUser()?.alias"
    />
    } 
    
    @else {
      <div class="w-6 h-6 rounded-full bg-gray-600 text-white flex items-center justify-center text-xs font-medium mx-auto">
        {{ initials }}
      </div>
    }
  </button>

  <mat-menu #userMenu="matMenu">
    <button mat-menu-item disabled>
      <mat-icon>settings</mat-icon>
      <span>Settings</span>
    </button>
    <button mat-menu-item (click)="logout.emit()">
      <mat-icon>logout</mat-icon>
      <span>Log Out</span>
    </button>

    <div class="px-4 py-3 border-t text-xs text-gray-500 flex flex-col gap-1 focus:outline-none" (click)="$event.stopPropagation()">
      <span class="font-medium text-gray-900">Logged in as</span>
      <span class="truncate max-w-[160px]" [title]="currentUser()?.email">
        {{ currentUser()?.email }}
      </span>
    </div>
  </mat-menu>

  <div class="flex gap-1">
    <button 
      mat-icon-button 
      (click)="openAddressBook.emit()"
      matTooltip="Address Book"
      aria-label="Open Contacts"
      class="text-gray-600"
    >
      <mat-icon>contacts</mat-icon>
    </button>

    <button 
      mat-icon-button 
      (click)="compose.emit()"
      matTooltip="New Message"
      aria-label="Compose Message"
      
      [color]="isComposeActive() ? 'primary' : ''"
      [class.bg-blue-50]="isComposeActive()"
      class="text-gray-600"
    >
      <mat-icon>edit_square</mat-icon>
    </button>
  </div>

</mat-toolbar>