<mat-toolbar class="flex justify-between short-toolbar bg-secondary-400">
  <div class="relative inline-block">
    <div
      class="absolute -top-2 -right-2 z-0 pointer-events-none transform scale-75"
    >
      <messenger-network-status />
    </div>

    <button
      type="button"
      mat-icon-button
      [matMenuTriggerFor]="userMenu"
      class="overflow-hidden relative z-20"
      aria-label="User Menu"
    >
      @if (currentUser()?.profileUrl) {
      <img
        alt="user profile"
        [src]="currentUser()?.profileUrl"
        class="w-full h-full object-cover rounded-full"
        [alt]="currentUser()?.alias"
      />
      } @else {
      <div
        class="w-6 h-6 rounded-full bg-gray-600 text-white flex items-center justify-center text-xs font-medium mx-auto"
      >
        {{ initials }}
      </div>
      }
    </button>
  </div>

  <mat-menu #userMenu="matMenu">
    <div
      class="px-4 py-3 border-b text-xs text-gray-500 flex flex-col gap-1 focus:outline-none"
      (click)="$event.stopPropagation()"
    >
      <span class="font-medium text-gray-900">Logged in as</span>
      <span class="truncate max-w-[160px]" [title]="currentUser()?.email">
        {{ currentUser()?.email }}
      </span>
    </div>

    <button mat-menu-item (click)="viewSettings.emit()">
      <mat-icon>settings</mat-icon>
      <span>Settings</span>
    </button>

    <button mat-menu-item (click)="logout.emit()">
      <mat-icon>logout</mat-icon>
      <span>Log Out</span>
    </button>
  </mat-menu>

  <div class="flex gap-1">
    <button
      type="button"
      mat-icon-button
      (click)="viewConversations.emit()"
      matTooltip="Conversations"
      [color]="activeView() === 'conversations' ? 'primary' : ''"
      [class.bg-blue-50]="activeView() === 'conversations'"
      class="text-gray-600 transition-colors"
    >
      <mat-icon>forum</mat-icon>
    </button>

    <button
      type="button"
      mat-icon-button
      (click)="viewContacts.emit()"
      matTooltip="Contacts"
      [color]="activeView() === 'contacts' ? 'primary' : ''"
      [class.bg-blue-50]="activeView() === 'contacts'"
      class="text-gray-600 transition-colors"
    >
      <mat-icon>people</mat-icon>
    </button>
  </div>
</mat-toolbar>
