{
  "name": "auth-flow-e2e",
  "$schema": "../../../node_modules/nx/schemas/project-schema.json",
  "projectType": "application",
  "prefix": "app",
  "sourceRoot": "apps/messenger/auth-flow-e2e/src",
  "tags": ["scope:messenger"],
  "targets": {
    "test": {
      "executor": "@nx/vite:test",
      "outputs": [
        "{options.reportsDirectory}",
        "{options.htmlReportDirectory}"
      ],
      "options": {
        "reportsDirectory": "coverage/apps/messenger/auth-flow-e2e",
        "htmlReportDirectory": "dist/test-reports/apps/messenger/auth-flow-e2e",
        "configFile": "apps/messenger/auth-flow-e2e/vitest.config.mts"
      }
    },
    "test-all": {
      "executor": "nx:run-commands",
      "options": {
        "env": {
          "IDENTITY_SERVICE_URL": "http://localhost:3000",
          "JWT_SECRET": "a-secure-e2e-test-secret-that-is-not-the-default-really",
          "GCP_PROJECT_ID": "gemini-power-test",
          "E2E_TEST_SECRET": "super-secret-value-for-e2e-tests"
        },
        "commands": [
          "npx nx serve node-identity-service",
          "npx wait-on http://localhost:3000/api/health-check && docker run --rm --network=host -e IDENTITY_SERVICE_URL=http://host.docker.internal:3000 -e JWT_SECRET -e GCP_PROJECT_ID -e GOOGLE_APPLICATION_CREDENTIALS=/tmp/adc.json -v \"C:\\Users\\tim\\AppData\\Roaming\\gcloud\\application_default_credentials.json\":/tmp/adc.json ghcr.io/tinywideclouds/go-key-service:latest",
          "npx wait-on http://localhost:3000/api/health-check && docker run --rm --network=host -e IDENTITY_SERVICE_URL=http://host.docker.internal:3000 -e GCP_PROJECT_ID -e API_PORT=8082 -e WEBSOCKET_PORT=8083 -e GOOGLE_APPLICATION_CREDENTIALS=/tmp/adc.json -v \"C:\\Users\\tim\\AppData\\Roaming\\gcloud\\application_default_credentials.json\":/tmp/adc.json ghcr.io/tinywideclouds/go-routing-service:latest",
          "npx wait-on http://localhost:3000/api/health-check http-get://localhost:8081/readyz http-get://localhost:8082/readyz && npx vitest run --config ./apps/messenger/auth-flow-e2e/vitest.config.mts"
        ],
        "parallel": true
      }
    },
    "serve-identity": {
      "executor": "nx:run-commands",
      "options": {
        "env": {
          "IDENTITY_SERVICE_URL": "http://localhost:3000",
          "JWT_SECRET": "a-secure-e2e-test-secret-that-is-not-the-default-really",
          "GCP_PROJECT_ID": "gemini-power-test",
          "E2E_TEST_SECRET": "super-secret-value-for-e2e-tests"
        },
        "commands": [
          "npx nx serve node-identity-service"
         ],
        "parallel": true
      }
    },
    "serve-deps": {
      "executor": "nx:run-commands",
      "options": {
        "env": {
          "IDENTITY_SERVICE_URL": "http://localhost:3000",
          "JWT_SECRET": "a-secure-e2e-test-secret-that-is-not-the-default-really",
          "GCP_PROJECT_ID": "gemini-power-test",
          "E2E_TEST_SECRET": "super-secret-value-for-e2e-tests",
          "LOG_LEVEL": "debug"
        },
        "commands": [
          "npx nx serve node-identity-service",
          
          "npx wait-on http://localhost:3000/api/health-check && docker run --rm --network=host --name e2e-key-service -e IDENTITY_SERVICE_URL=http://host.docker.internal:3000 -e JWT_SECRET -e GCP_PROJECT_ID -e GOOGLE_APPLICATION_CREDENTIALS=/tmp/adc.json -v \"C:\\Users\\tim\\AppData\\Roaming\\gcloud\\application_default_credentials.json\":/tmp/adc.json ghcr.io/tinywideclouds/go-key-service:latest",

          "npx wait-on http://localhost:3000/api/health-check && docker run --rm --network=host --name e2e-routing-service -e IDENTITY_SERVICE_URL=http://host.docker.internal:3000 -e GCP_PROJECT_ID -e API_PORT=8082 -e WEBSOCKET_PORT=8083 -e GOOGLE_APPLICATION_CREDENTIALS=/tmp/adc.json -v \"C:\\Users\\tim\\AppData\\Roaming\\gcloud\\application_default_credentials.json\":/tmp/adc.json ghcr.io/tinywideclouds/go-routing-service:latest"
        ],
        "parallel": true
      }
    },
    "serve-keys": {
      "executor": "nx:run-commands",
      "options": {
        "env": {
          "IDENTITY_SERVICE_URL": "http://localhost:3000",
          "JWT_SECRET": "a-secure-e2e-test-secret-that-is-not-the-default-really",
          "GCP_PROJECT_ID": "gemini-power-test",
          "E2E_TEST_SECRET": "super-secret-value-for-e2e-tests"
        },
        "commands": [
          "npx wait-on http://localhost:3000/api/health-check && docker run --rm -p 8081:8081 --name e2e-key-service -e IDENTITY_SERVICE_URL=http://host.docker.internal:3000 -e JWT_SECRET -e GCP_PROJECT_ID -e GOOGLE_APPLICATION_CREDENTIALS=/tmp/adc.json -v \"C:\\Users\\tim\\AppData\\Roaming\\gcloud\\application_default_credentials.json\":/tmp/adc.json ghcr.io/tinywideclouds/go-key-service:latest"
        ],
        "parallel": true
      }
    },
    "shutdown-deps": {
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "docker stop e2e-key-service e2e-routing-service",
          "echo 'E2E services shut down.'"
        ]
      }
    },
    "test-only": {
      "executor": "nx:run-commands",
      "options": {
        "env": {
          "E2E_TEST_SECRET": "super-secret-value-for-e2e-tests"
        },
        "commands": [
          "npx wait-on http://localhost:3000/api/health-check http-get://localhost:8081/readyz http-get://localhost:8082/readyz && npx vitest run --config ./apps/messenger/auth-flow-e2e/vitest.config.mts"
        ]
      }
    },
    "lint": {
      "executor": "@nx/eslint:lint"
    }
  }
}
